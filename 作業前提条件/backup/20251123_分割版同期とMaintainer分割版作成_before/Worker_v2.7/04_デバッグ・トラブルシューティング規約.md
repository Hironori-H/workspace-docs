# デバッグ・トラブルシューティング規約 - Worker用

## 📌 このモジュールについて

**用途**: デバッグ・トラブルシューティング中のファイル管理、中間ファイルの命名規則
**必読条件**: デバッグ作業やエラー修正を行う際に必読
**関連モジュール**:
- `02_ファイル管理.md` - 通常のファイル管理規則
- `03_バッチファイル・スクリプト規約.md` - スクリプト作成規約

---

## デバッグ・トラブルシューティング中のファイル管理

### 問題の背景

**よくある問題**:
- デバッグ中に `script_debug.py`, `script_fixed.py`, `script_v2.py` などが乱立
- どれが最新版か分からなくなる
- 作業完了後も中間ファイルが残ってしまう
- バージョン管理が統一されていない

**実例**:
```
UE_automation/
├── launch_full_automation.bat         # オリジナル
├── launch_full_automation_debug.bat   # デバッグ版
├── launch_full_automation_fixed.bat   # 修正版
├── launch_full_automation_v2.bat      # バージョン2
└── launch_debug.log                   # デバッグログ
```
→ **どれが最終版か不明瞭**

---

### 中間ファイルの命名規則（統一ルール）

#### 1. デバッグ版
**命名規則**: `[元のファイル名]_debug.[拡張子]`

**例**:
- `launch_automation.bat` → `launch_automation_debug.bat`
- `render_controller.py` → `render_controller_debug.py`

**用途**:
- 詳細なログ出力を追加したバージョン
- エラー原因の特定用
- 一時的なトラブルシューティング用

**重要**: デバッグ版は**問題解決後に削除または移動**すること

---

#### 2. 修正版（複数の修正を試す場合）
**命名規則**: `[元のファイル名]_fix[番号].[拡張子]`

**例**:
- `launch_automation.bat` → `launch_automation_fix1.bat`
- `launch_automation.bat` → `launch_automation_fix2.bat`
- `launch_automation.bat` → `launch_automation_fix3.bat`

**用途**:
- 複数の修正案を試す場合
- どの修正が有効か比較検証する場合

**番号のルール**:
- fix1, fix2, fix3 のように連番
- 最も新しい番号が最新の修正版

**重要**: 最終的に有効な修正版のみを残し、他は削除または移動

---

#### 3. バージョン管理（正式なバージョンアップ）
**命名規則**: `[元のファイル名]_v[メジャー].[マイナー].[拡張子]`

**例**:
- `launch_automation.bat` → `launch_automation_v1.0.bat`
- `launch_automation.bat` → `launch_automation_v1.1.bat`
- `launch_automation.bat` → `launch_automation_v2.0.bat`

**用途**:
- 正式なバージョンアップ時
- 複数バージョンを保持する必要がある場合
- 後方互換性のため旧バージョンを残す場合

**バージョン番号のルール**:
- **メジャーバージョン**: 大幅な機能追加・仕様変更（v1.0 → v2.0）
- **マイナーバージョン**: 小規模な機能追加・改善（v1.0 → v1.1）

**重要**:
- 通常は最新バージョンのみを使用
- 旧バージョンが不要なら削除または `archive/` フォルダに移動

---

#### 4. 禁止事項（使ってはいけない命名）

以下の命名は**混乱を招くため使用禁止**:

- ✗ `script_new.py` （何が新しいか不明）
- ✗ `script_latest.py` （時間が経つと latest ではなくなる）
- ✗ `script_final.py` （final の後にさらに修正が発生する）
- ✗ `script_v2.py` （v2.0 なのか v0.2 なのか不明）
- ✗ `script_test.py` （デバッグ版なのかテストコードなのか不明）
- ✗ `script_copy.py` （何のコピーか不明）
- ✗ `script_backup.py` （バックアップは別の方法で管理）

**理由**:
- 時間が経つと意味が不明瞭になる
- どれが最新版か判断できない
- バージョン管理の一貫性がない

---

### デバッグ・トラブルシューティングのワークフロー

#### Phase 1: 問題発生時
1. **デバッグ版を作成**
   ```
   launch_automation.bat → launch_automation_debug.bat
   ```
2. **詳細なログ出力を追加**
   - エラー箇所の特定
   - 変数の値を出力
   - 処理の進行状況を記録

3. **デバッグログを保存**
   ```
   launch_automation_debug.log
   ```

---

#### Phase 2: 修正を試す
1. **修正版を作成**（複数の修正案を試す場合）
   ```
   launch_automation_fix1.bat
   launch_automation_fix2.bat
   launch_automation_fix3.bat
   ```

2. **各修正版をテスト**
   - どの修正が有効か検証
   - 副作用がないか確認

3. **最も有効な修正版を特定**
   - fix2 が最良の修正だと判明

---

#### Phase 3: 最終版の確定
1. **オリジナルファイルを更新**
   ```
   launch_automation.bat を最良の修正内容で上書き
   ```

2. **中間ファイルを整理**
   - `debug_files/` フォルダに移動:
     - `launch_automation_debug.bat`
     - `launch_automation_fix1.bat`
     - `launch_automation_fix2.bat`
     - `launch_automation_fix3.bat`
     - `launch_automation_debug.log`

3. **作業ログに記録**
   ```markdown
   ## デバッグ作業
   - 問題: バッチファイルがすぐに終了してしまう
   - 原因: パスに含まれる括弧がバッチファイルで正しく処理されない
   - 解決策: PowerShellの Test-Path を使用
   - 修正版: fix2 が最良（他の修正版は debug_files/ に移動）
   ```

---

#### Phase 4: バージョンアップ（必要な場合）
**正式なバージョンアップが必要な場合のみ**:

1. **バージョン番号を付与**
   ```
   launch_automation.bat → launch_automation_v1.1.bat
   ```

2. **変更履歴を記録**
   - ファイル内のコメントまたは README に変更内容を記載

3. **旧バージョンの扱い**
   - 後方互換性のため保持する場合: そのまま残す
   - 不要な場合: `archive/` フォルダに移動

---

### デバッグファイル専用フォルダの活用

#### フォルダ構造
```
20251114/
├── UE_automation/
│   ├── launch_full_automation.bat        # 最終版（これのみ残す）
│   ├── setup_project_config.py
│   └── debug_files/                      # デバッグ・中間ファイル専用
│       ├── launch_full_automation_debug.bat
│       ├── launch_full_automation_fix1.bat
│       ├── launch_full_automation_fix2.bat
│       ├── launch_full_automation_fix3.bat
│       └── launch_debug.log
```

#### 運用ルール
1. **問題解決後、すぐに中間ファイルを移動**
   - デバッグ版
   - 修正版（採用されなかったもの）
   - デバッグログ

2. **debug_files/ フォルダの削除タイミング**
   - 作業完了後、1週間程度保持
   - 問題が再発しないことを確認
   - その後、フォルダごと削除または reject_file/ に移動

3. **最終版のみを残す**
   - メインフォルダには最終版のみ
   - バージョン管理が必要な場合のみ、複数バージョンを保持

---

### チェックリスト: 作業完了時の確認

問題が解決したら、以下を必ず確認：

- [ ] 最終版のファイルを特定した
- [ ] オリジナルファイルを最終版で更新した
- [ ] デバッグ版を `debug_files/` に移動した
- [ ] 採用されなかった修正版を `debug_files/` に移動した
- [ ] デバッグログを `debug_files/` に移動した
- [ ] 作業ログに問題・原因・解決策を記録した
- [ ] メインフォルダに不要なファイルが残っていないことを確認した
- [ ] バージョン番号が必要な場合、適切に付与した

---

### 正しい例と誤った例

#### ✓ 正しい例
**作業完了後のフォルダ構成**:
```
UE_automation/
├── launch_full_automation.bat            # 最終版のみ
├── setup_project_config.py
├── Unreal_Engine自動化_利用ガイド.txt
└── debug_files/                          # 中間ファイルは別フォルダ
    ├── launch_full_automation_debug.bat
    ├── launch_full_automation_fix1.bat
    ├── launch_full_automation_fix2.bat
    └── launch_debug.log
```

**メリット**:
- 最終版が一目瞭然
- 中間ファイルは保持しつつ、混乱しない
- 後で確認が必要な場合は debug_files/ を見ればよい

---

#### ✗ 誤った例
**作業完了後もファイルが乱立**:
```
UE_automation/
├── launch_full_automation.bat           # どれが最終版？
├── launch_full_automation_debug.bat
├── launch_full_automation_fixed.bat
├── launch_full_automation_v2.bat
├── launch_debug.log
└── setup_project_config.py
```

**問題点**:
- どれが最終版か不明
- 次回作業時に混乱する
- ファイルが増え続ける
- バージョン管理が統一されていない

---

### 重要原則

1. **中間ファイルは一時的なもの**
   - デバッグ版・修正版は問題解決後に整理
   - メインフォルダには最終版のみを残す

2. **命名規則を統一**
   - デバッグ版: `_debug`
   - 修正版: `_fix[番号]`
   - バージョン管理: `_v[メジャー].[マイナー]`

3. **作業完了後は必ずクリーンアップ**
   - 中間ファイルを `debug_files/` に移動
   - 不要なログファイルを整理
   - 作業ログに記録

4. **「latest」「final」「new」などの曖昧な命名は禁止**
   - 時間が経つと意味が不明瞭になる
   - 明確な命名規則を使用

---
